---
title: Kaplan Meier plots
author: Sebastian Gerdes
date: 2023-08-03
categories:
  - R
toc: true
# draft: true
# execute: 
#   echo: false
#  cache: true
---

Goal: draw facetted Kaplan-Meier-plots with p-value

## With ggquickeda
```{r}
library('tidyverse')
library('survival')
library('ggquickeda')

text_to_add <- 
  tribble(~ sex, ~ text, ~ x, ~ y, 
          'Male', 'p = 0.1', 3000, 0.95,
          'Female', 'p = 0.03', 3000, 0.95)



colon |> 
  mutate(sex = case_when(
    sex == 1 ~ 'Male',
    sex == 0 ~ 'Female')) |> 
  mutate(perfor = factor(perfor)) |> 
  
  ggplot(aes(time = time, status = status, colour = perfor)) + 
  facet_wrap(vars(sex)) +
  geom_km() + geom_kmticks() + 
  geom_label(mapping = aes(label = text, 
                           x = x, 
                           y = y), 
             data = text_to_add, 
             inherit.aes = FALSE) +
  labs(x = 'Time', y = 'Estimated survival')

```


## With survminer
```{r}
library('survminer')
fit <- survfit( Surv(time, status) ~ sex, data = colon )
ggsurvplot_facet(fit, colon, facet.by = c('rx', 'perfor'), 
                 pval = TRUE, ggtheme = theme_grey())
```

